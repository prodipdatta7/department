name: Beautify Bug Report
on:
  issues:
    types: [opened]

jobs:
  pretty:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: Parse issue form
        id: parse
        uses: edumserrano/github-issue-forms-parser@v1
        with:
          template-filepath: '.github/ISSUE_TEMPLATE/bug_report.yaml'
          issue-form-body: '${{ github.event.issue.body }}'   # <-- form body
      - name: Comment summary
        uses: actions/github-script@v7
        env:
          PARSED: '${{ steps.parse.outputs.parsed-issue }}'
        with:
          script: |
            const data = JSON.parse(process.env.PARSED);
            const pri = (data.priority || [])[0] || '_None_';
            const envSel = (data.environment && data.environment.selected) || [];
            const mods = data.module || [];
            const assigs = data.assignee || [];
            const body = `**Priority:** ${pri}\n**Env:** ${envSel.join(', ') || '_None_'}\n**Modules:** ${mods.join(', ') || '_None_'}\n**Assignees:** ${assigs.join(', ') || '_None_'}\n`;
            await github.rest.issues.createComment({ ...context.repo, issue_number: context.payload.issue.number, body });
